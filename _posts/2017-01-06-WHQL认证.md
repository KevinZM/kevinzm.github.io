## WHQL认证


###  Windows HCK Prerequisites


开始测试之前，请确保测试环境满足必要的要求。 Windows HCK由两个组件组成：HCK测试服务器和一个或多个测试计算机。


**HCK测试服务器。**通常被称为控制器，测试服务器有两个部分：Windows HCK控制器和Windows HCK Studio。 Controller软件是管理在测试计算机上运行的测试的引擎。 Studio软件是一种管理工具，可让您针对连接到测试服务器的任何测试计算机选择和计划测试。控制器和Studio是从Windows HCK安装源安装的。一旦建立，测试服务器包含单独的安装程序，以便安装远程Windows HCK Studio和Windows HCK客户端。


一个控制器管理客户端计算机的集合。控制器只能管理和访问他们管理的客户端计算机。


**测试计算机。**也称为客户端计算机，每个可以具有适合于各种测试场景的不同配置，包括不同的硬件，操作系统，服务包和驱动器。每个测试计算机只能与一个测试服务器关联。通过直接从测试服务器上的共享网络位置运行Windows HCK Client软件安装程序来配置每个测试计算机。


#### **部署方案**

有两种Windows HCK的部署方案：


**加入域的环境。**在加入域的环境中，存在域控制器，并且为Windows HCK功能指定的所有计算机都加入到同一个域控制器。如果计划在加入域的环境中部署Windows HCK，则至少需要三台计算机：Windows域控制器，Windows HCK测试服务器和一台Windows HCK测试计算机。确保Microsoft ActiveDirectory®已在域控制器上配置和运行。您的域控制器和HCK测试服务器不能在同一个框。


**工作组环境。**工作组环境没有域控制器。如果计划在工作组中部署Windows HCK，则至少需要两台计算机：连接到同一工作组的测试服务器和测试计算机。不要使用默认管理员帐户。在此配置中，必须启用Guest帐户。


此外，考虑如何组织实验室资源以最佳地使用Windows HCK。您需要确定测试服务器的数量和连接到它们的测试计算机的数量。这些决定部分地受到您要认证的设备或系统的类型的影响。


要测试系统和过滤器驱动程序，您需要至少1个测试服务器和1个测试计算机。
要测试外部设备，您需要至少1个测试服务器，1个测试计算机和要测试的外部设备。


如果您希望减少管理控制器和客户端的开销，您可以选择分配更少的控制器，每个控制器具有连接到它们的多个客户端。最多150个客户端可以连接到单个控制器。或者，您可以分配更多的控制器并将较少的客户端连接到它们。这允许任何给定的控制器更灵敏，因为它有更少的客户端与它通信。有关更多信息，请参阅HCK控制器和客户端组织。


下图显示了一个示例测试环境。


![](/img/201701061.png)


Test server


|Component|Minimum|Optimum|
|-|-|-|
|CPU|2.0GHz|2.0GHz及以上|
|MEM|2 GB|4 GB|
|Disk|300GB|RAID配置|
|Network|100Mbps|1Gbps|
|OS|English language and English local version of Windows Server 2008 R2 64-bit with service pack (SP1) or Windows Server® 2012.| |


**注意：**
- **Controller isn't supported on Windows Server 2003, Windows Server 2008, Windows Vista, Windows XP, or Windows 2000.**


- **Controller isn't supported on an installation that has already been set up as a domain controller.**


- **Controller isn't supported in a virtual PC or any third-party Hypervisor environment.**



Test computer


|Component|Minimum|
|-|-|
|CPU|2.0GHz|
|MEM|2 GB|
|Disk|300GB|
|Network|100Mbps|
|OS|Windows Server 2008/Windows Server 2008 R2 64-bit/Windows Server®2012.R2|



**其他**

- **将测试计算机配置为从硬盘驱动器的常规引导扇区引导，而不是从外部设备，CD或DVD引导光盘引导。**


- **对于Workgroup环境，必须启用guest帐户。**


- **在每台计算机上，创建一个新用户帐户并将其添加到管理员组。**


- **在每台计算机上，使用刚才创建的管理员帐户登录并启用访客帐户。**


测试还可能需要：

- HCK过滤器。


- 测试符号驱动程序。


- 在包创建结束时请求的其他源代码/自述文件。



### 安装 Windows HCK


使用 Windows 硬件认证工具包测试硬件。它包含认证你的 Windows 硬件所需的工具、流程和测试。首先阅读 HCK 必备条件，然后完成以下 3 步。


#### 步骤 1：安装 HCK


在此步骤中，您在指定的测试服务器上安装Windows HCK软件。 测试服务器应预先安装Windows Server 2008 R2或WindowsServer®2012.安装程序除了安装其他资源之外还安装Windows HCK控制器和Studio。


1. 从Windows开发人员中心下载Windows HCK

2. 从下载位置，单击下载\>立即。

	**注意**

	**如果要直接下载到服务器上，必须禁用IE增强安全配置（IE ESC）。**

3. 出现提示时，选择运行。

	**警告**

	**不要选择保存选项。保存选项只下载Windows HCK安装程序，而不是完整的工具包。**

4. 当出现“指定位置”屏幕时，选择适当的选项：

	a)	安装选项 - 选择将Windows HCK安装到此计算机，然后单击安装。

	b)	下载选项 - 选择下载Windows HCK在单独的计算机上安装，然后单击下一步。

5. 选择Controller + Studio选项。

	如果要直接安装，则必须在服务器上打开一个端口。选择是，打开端口。

6. 当出现加入客户体验改善计划（CEIP）屏幕时，选择是或否，然后单击下一步。

	**注意**

	**如果您的网络未连接到Internet，请选择否。**

7. 查看许可协议，然后单击接受以继续。

8. 如果选择安装选项，安装大约需要45分钟。如果计算机上尚未安装Microsoft .NET Framework 4.5，请按照提示进行安装。计算机重新启动后，必须重复步骤1中的安装说明，以便安装到此计算机。

	如果选择了下载选项，请将下载内容复制到测试服务器。运行HCKSetup.exe并重复步骤3中的安装说明以安装到此计算机。

	**重要**

	**如果要将HCK环境升级到更高版本，则必须先从测试服务器和连接的测试客户端卸载先前版本的HCK软件。**


#### 步骤 2：添加测试计算机


在测试服务器上安装Windows硬件认证工具包（Windows HCK）后，即可将测试计算机添加到环境中。您必须在每个测试计算机上安装Windows HCK客户端软件。 Windows HCK客户端软件存储在Windows HCK测试服务器上。


**警告**

**如果要测试软件，请务必先在测试计算机上安装产品，然后安装Windows HCK Client软件。**

 
 **安装Windows HCK客户端**

1. 在测试计算机上，浏览到以下位置：

	对于x86和X64，键入\\ \<ControllerName\>  HCKInstall  Client  Setup.exe。
	 

	**注意**

	**将\<ControllerName\>替换为测试服务器的名称。**

	**如果尚未安装以下软件，则在此步骤中安装以下软件：.NET Framework 4（客户端配置文件和扩展），应用程序验证程序，Windows驱动程序测试框架（WDTF）和Windows性能测试（WPT）。**
	 

2. 将显示Windows HCK硬件认证工具包客户端安装向导。要启动向导，请单击下一步。

3. 在“Internet连接防火墙协议”页面上，选择是我将允许打开端口，然后单击下一步。


	**注意**

	**如果未出现Internet连接防火墙协议页面，则不会安装Windows软件防火墙，或计算机上安装了其他软件防火墙或硬件防火墙。如果安装了另一个防火墙，则必须手动打开TCP端口1771以继续安装。请参阅防火墙产品附带的说明手动打开TCP端口。否则，安装可能会失败或客户端软件可能无法正常工作。**
	 
4. 出现“准备安装”页面时，选择“安装”。

5. 单击完成退出向导。

	**提示**

	**安装完成后，单击开始\>控制面板\>卸载程序以确认其成功。确认Windows硬件认证工具包客户端出现在程序列表中。**
	 
6. 对每个测试计算机重复步骤1-5。


#### 步骤 3：创建计算机池

机器池是一个或多个测试计算机的逻辑分组。在每台测试计算机上安装Windows HCK Client后，计算机将自动添加到默认计算机池。在使用测试计算机之前，必须将其移动到工作计算机池。

每个项目都需要一个机器池。机器池可用于多个项目。项目可以引用多个机器池。

下图显示了Studio配置页。


![](/img/201701062.png)


HCK Studio配置机器管理选项卡

**创建机器池**

1. 在Windows HCK Studio中，单击配置。

2. 选择现有机器池，然后单击创建机器池或右键单击现有机器池，并选择创建机器池。
	 
3. 默认情况下，新池被命名为“新池1”。您可以通过键入不同的名称，然后按Enter键更改此设置。
	 
4. 单击默认池，然后确认每个测试计算机出现在主窗格中。如果已在多个测试计算机上安装客户端软件，则可以将其中任何一个添加到池中。

	 **注意**

	**一台计算机一次只能在一个池中。**
	 

5. 选择测试计算机，然后将其拖动到新创建的池。

6. 在机器下，右键单击测试计算机，单击更改计算机状态，然后单击就绪。
	 “状态”列将更改为“就绪”。

	 **警告**

	**您不能对状态等于NotReady的计算机计划测试。在默认池中，计算机无法设置为就绪。**


7. 对要包括在池中的每个测试计算机重复此操作。

8. 单击返回箭头返回到Windows HCK Studio的主区域。

将所有测试计算机放在池中后，您就可以对这些计算机进行测试。


#### 步骤 4：创建项目


设置测试服务器和客户端后，即可开始测试。第一步是创建一个项目。项目定义了要测试的内容。最常见的项目是您要提交认证的设备。在此示例中，您创建一个项目，运行与该设备关联的所有认证测试，最后创建一个包含所有通过的测试结果的包。

通过新的HCK测试概念功能，您可以创建代表各种场景的项目。此外，您可以创建几个较小的项目，并将结果合并到一个包中。

下图显示了Studio项目标签。


![](/img/201701063.png)


HCK 2.1 Studio项目选项卡

**创建项目**

1.	在服务器计算机上，打开HCK Studio。

2.	在项目选项卡上，单击创建项目。

3.	将默认项目名称替换为项目的名称，然后按Enter键。

**注意**

**项目应具有指示其内容的有意义的名称，例如，“Fabrikam多功能设备型号Z”。**
 

当项目名称出现在页面上时，将创建项目。

右窗格显示项目详细信息。最初，在您开始测试设备之前，信息为空。创建多个项目时，可以加载不同的项目以检查状态。


#### 步骤5：选择要认证的目标


Windows HCK Studio检测设备实现的所有功能。特定的可测试设备称为目标。设备可以包含由一个或多个硬件ID表示的多个目标。使用选择选项卡，您可以使用以下视图筛选要测试的内容：

**系统。**
测试完整的客户端或服务器计算机。

**设备和打印机。**
测试连接到测试计算机的外部设备。此设备通常显示在测试计算机上的开始\>设备和打印机中。

**设备管理器。**
测试测试计算机或外部设备的组件，例如网卡。这是最详细的视图。

**软件设备。**
测试测试计算机上安装的过滤器驱动程序，防火墙和防病毒软件。

**注意**

**一些软件驱动程序与物理设备相关联。如果在软件设备下找​​不到驱动程序，请使用设备管理器上的搜索栏找到与软件驱动程序关联的设备。**
 

下图显示了Studio选项标签。


![](/img/201701064.png)


HCK 2.1工作室选择选项卡

**选择要认证的目标**

1. 单击选择选项卡。从机器池列表（左上角的下拉列表）中，选择包含要认证的设备的池。

2. 从左窗格中，根据要验证的设备选择视图：系统，设备和打印机，设备管理器或软件设备。

	可用目标的列表显示在中心详细视图中。如果您选择设备管理器，则可以选择显示收件箱和隐藏的功能。

3. 从中心详细视图中，选中要测试的每个目标旁边的复选框。

**注意**

**您必须为要接收认证的设备选择特定产品类型的所有功能。**
**如果您正在测试设备上的Web服务（WSD）设备，则在列出所需的WSD目标之前可能会有延迟。**
 

show selected选项显示您在其他视图中选择的目标。此视图允许您仅查看要测试的区域。您还可以使用类别列表按类别过滤机器池。您可以使用搜索框搜索特定目标/功能。


#### 步骤6：选择并运行测试


“测试”选项卡显示与在设备上找到的功能相关联的所有测试。您可以通过以下方式过滤和排序测试结果：
级别（基本，功能，可靠性，认证，经验，可选）
状态
测试名称
类型（手动，非分布式，特殊配置，多机）
长度
目标
机器
因为手动测试中断了测试过程以等待用户输入，我们建议您将它们与自动测试分开运行。某些自动化测试需要其他参数，然后才能运行它们。

下图显示了Studio测试标签。


![](/img/201701065.png)

HCK 2.1 Studio测试选项卡
运行测试

1.	使用查看方式下拉列表过滤测试结果。
2.	选中要运行的每个测试旁边的复选框。
3.	要运行所选测试，请单击运行所选项。

将显示进度条。运行测试时会出现轻微延迟。

一些测试在运行之前需要额外的输入。 Windows HCK Studio提示您相应的更多信息。要了解有关任何测试的更多信息，请从列表中选择测试，然后按F1键或右键单击并选择帮助。要取消任何正在运行的测试，请右键单击它并选择取消。


测试完成后，每个测试的结果显示在“状态”列中。绿色的勾号表示它通过了;红色X表示失败。右窗格显示项目摘要信息，包括选择的目标，测试的操作系统，您符合条件的产品类型和所有测试的状态。

#### 步骤7：查看测试结果和日志文件

结果选项卡显示有关每个测试的详细信息。 每次测试完成后，状态列将使用结果传递或失败更新。

下图显示了Studio结果选项卡。


![](/img/201701066.png)


HCK 2.1演播室结果标签
排除测试失败故障

如果测试失败，您可以展开测试详细信息以查看关联的日志文件。

1. 从列表中，选择一个失败的测试，以红色X表示。

2. 展开“测试名称”节点，展开“日志”节点，然后双击日志文件。

您可以查看这些日志文件：

.log文件。 文本转储。

.wtl文件。 打开以查看错误报告。

.xml文件。 将文件扩展名更改为.wtl以查看错误报告。

右键单击任何测试以查看其他测试详细信息，包括：

任务日志。

其他文件。

应用过滤器。

错误。

基础设施（收集和执行日志）。


#### 步骤8：创建提交包

设备通过所有必要的测试后，您可以创建提交包（.hckx文件）以提交。


Windows HCK Studio支持创建包，因此您不需要使用单独的提交工具。它支持添加完成认证所需的资源文件（驱动程序，符号，勘误表）。您还可以将多个软件包（.hckx文件）合并到一个软件包中。


下图显示了Studio Package选项卡。


![](/img/201701067.png)


HCK Studio软件包选项卡
创建提交包

1. 选择“软件包”选项卡。

2. 如果您为设备使用了特殊驱动程序（可选），请按以下步骤提交：

	a)	单击添加驱动程序文件夹\>浏览以选择文件夹，然后单击确定。

	b)	在“驱动程序属性”对话框中，选择相应的“产品和语言环境”，然后单击“确定”。

3. 要添加符号（可选），请右键单击驱动程序文件夹，单击添加符号\>浏览以选择文件夹，然后单击确定。

4. 要添加补充文件夹（可选），如自述文件，意外事件消息，勘误表或手动过滤器，请单击添加补充文件夹\>浏览以选择文件夹，然后单击确定。

5. 单击创建包。

6. 从签名选项对话框中，选择以下选项之一：


**重要**

**所有提交的作品必须进行数字签名。**

 
不要签名创建一个未签名的包，例如，发送到支持调试或以后与其他包合并到一个提交包。


使用证书存储创建数字签名软件包 - 最常见的方案。此选项需要在运行Windows HCK Studio的计算机上安装X509证书（例如VeriSign证书）。从Windows安全对话框中，选择相应的代码签名证书。

使用证书文件通过使用便携式安全文件创建数字签名的包。此选项要求您提供X509证书文件（.cer文件）。

有关合并和查看软件包的其他信息，请参阅 [HCK Studio - Package Tab](https://msdn.microsoft.com/zh-cn/library/windows/hardware/dn293688.aspx)。

**下一步**

恭喜您，您已使用Windows HCK完成了设备的端到端测试。通过Windows开发人员中心的硬件仪表板提交签名的软件包（.hckx文件）。有关更多详细信息，请参阅Windows开发人员中心中的[仪表板帮助](http://go.microsoft.com/fwlink/?LinkId=236060)。
